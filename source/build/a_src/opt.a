; app.c
; Copyright (C) 2007 Paul C. Pratt
;
; You can redistribute this file and/or modify it under the terms
; of version 2 of the GNU General Public License as published by
; the Free Software Foundation.  You should have received a copy
; of the license along with this file; see the file COPYING.

; This file is distributed in the hope that it will be useful,
; but WITHOUT ANY WARRANTY; without even the implied warranty of
; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
; license for more details.

; inspired by Apple's TESample that came with MPW 3

ASMCLIKLOOP	PROC		EXPORT

			IMPORT		GETOLDCLIKLOOP
			IMPORT		PASCALCLIKLOOP

			MOVEM.L		D1-D2/A1,-(SP)		; D0 and A0 need not be saved
			CLR.L		-(SP)				; make space for procedure pointer
			JSR			GETOLDCLIKLOOP		; get the old clikLoop
			MOVEA.L		(SP)+,A0			; into A0
			MOVEM.L		(SP)+,D1-D2/A1		; restore the world as it was

			JSR			(A0)				; and execute old clikLoop

			MOVEM.L		D1-D2/A1,-(SP)		; D0 and A0 need not be saved
			JSR			PASCALCLIKLOOP		; do our clikLoop
			MOVEM.L		(SP)+,D1-D2/A1		; restore the world as it was
			MOVEQ		#1,D0				; clear the zero flag so TextEdit keeps going
			RTS

			END
