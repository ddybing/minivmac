# make file generated by gryphel build system

mk_AOptions = -c -arch i386

mk_COptions = -c -Wall -Wmissing-prototypes -Wstrict-prototypes -Wno-uninitialized -mdynamic-no-pic -fpascal-strings -arch i386 -mmacosx-version-min=10.4 -isysroot /Developer/SDKs/MacOSX10.4u.sdk
# -Os

TheDefaultOutput : Build.app/Contents/MacOS/Build

bld/program.o : src/program.c
	gcc "src/program.c" -o "bld/program.o" $(mk_COptions) \
		-I "../../source/build/c_src/" -I "../../source/app/build/"

ObjFiles = \
	bld/program.o \


Build.app/Contents/Resources/AppIcon.icns : ../../source/build/platform/osx/AppIcon.icns
	rm -fr "Build.app/"
	rm -fr "AppTemp/"
	mkdir "AppTemp/"
	mkdir "AppTemp/Contents/"
	mkdir "AppTemp/Contents/MacOS/"
	mkdir "AppTemp/Contents/Resources/"
	mkdir "AppTemp/Contents/Resources/English.lproj/"
	cp "../../source/build/platform/osx/AppIcon.icns" "AppTemp/Contents/Resources/"
	cp "src/Info.plist" "AppTemp/Contents/"
	echo "dummy" > "AppTemp/Contents/Resources/English.lproj/dummy.txt"
	echo -n "APPL????" > "AppTemp/Contents/PkgInfo"
	mv "AppTemp/" "Build.app/"

Build.app/Contents/MacOS/Build : $(ObjFiles) Build.app/Contents/Resources/AppIcon.icns Build.app/Contents/Resources/Build.rsrc
	gcc \
		-o "Build.app/Contents/MacOS/Build" -framework Carbon -framework OpenGL -framework AGL -arch i386 -mmacosx-version-min=10.4 -isysroot /Developer/SDKs/MacOSX10.4u.sdk \
		$(ObjFiles)
	strip -u -r "Build.app/Contents/MacOS/Build"

Build.app/Contents/Resources/Build.rsrc : src/main.r Build.app/Contents/Resources/AppIcon.icns
	/Developer/Tools/Rez \
		-i /Developer/Headers/FlatCarbon \
		"src/main.r" \
		-o "Build.app/Contents/Resources/Build.rsrc" \
		-useDF

clean :
	rm -f $(ObjFiles)
	rm -fr "Build.app/"
